{% extends 'base.html.twig' %}

{% block title %}Vos vidéos{% endblock %}

{% block body %}

{{ render(controller('App\\Controller\\UserController::userProfile'))}}

{% for message in app.flashes('success') %}
<div class="alert alert-success">
    {{message}}
</div>
{% endfor %}

<a href="{{path('addvideo')}}"><button class="btn btn-primary add_video">Ajouter vidéos</button></a>

{{render(controller('App\\Controller\\ProfileController::searchUserVideos'))}}

<div class="row" id="uservideos">
    {% for video in videos | slice(0, 20) %}
    <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-4">
        <div class="item-listing-container-skrn video-card">
            <a href="{{path("movie", {"id" : video.id, "idcategory" : video.category.id})}}"><img
                    src="{{asset('images/upload/' ~ video.videoimage)}}" alt="Listing"
                    class="imagemovie img-responsive"></a>
            <div class="item-listing-text-skrn">
                <div class="item-listing-text-skrn-vertical-align">
                    <h6><a
                            href="{{path("movie", {"id" : video.id, "idcategory" : video.category.id})}}">{{video.videotitle}}</a>
                    </h6>
                </div><!-- close .item-listing-text-skrn-vertical-align -->
            </div><!-- close .item-listing-text-skrn -->
            <div>
                <a href="{{path('update_video_image', {'id': video.id})}}"><button
                        class="btn btn-primary btn-sm btn_update"><i class="fas fa-image fa-2x"></i></button></a>
                <a href="{{path('delete_video', {'id': video.id})}}"><button
                        class="btn btn-primary btn-sm btn_delete"><i class="fas fa-trash-alt fa-2x"></i></button></a>
                <a href="{{path('update_video_description', {'id': video.id})}}"><button
                        class="btn btn-primary btn-sm btn_delete"><i class="far fa-edit fa-2x"></i></button></a>
            </div>
        </div><!-- close .item-listing-container-skrn -->
    </div><!-- close .col -->
    {% endfor %}
</div><!-- close .row -->

<div class="pagination">
    <div class="navigation" id="loadbutton">
        <button class="btn btn-primary" id="loadMoreUserVideos">Load more</button>
    </div>
</div>

</div><!-- close .dashboard-container -->
</main>
{% endblock %}

{% block javascripts %}
{{ parent()}}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    click = 0;

    function loadMoreUserVideos(event) {
        event.preventDefault();
        click++;
        var start = 20 * click;
        const url = "{{path('loadMoreUserVideos')}}/" + start;
        axios.get(url).then(function (response) {
            $("#uservideos").append(response.data);
            if (!response.data) {

                let loadButton = document.getElementById("loadbutton");
                loadButton.textContent = 'Plus aucune vidéo à afficher';

            }
        }).catch(function (error) {
            if (response.status === 403) {
                window.alert("You are not authorized to perform this action!");
            } else if (response.status === 404) {
                window.alert("This page does not exist");
            } else {
                window.alert("An error has occurred !");
            }
        });
    }
    document.getElementById("loadMoreUserVideos").addEventListener("click", loadMoreUserVideos);
</script>
{% endblock %}